name: "Docker Build & Push"
description: "Build and push Docker image"

inputs:
  compose-file:
    description: "Path to the Docker Compose file"
    required: true
  image_tag:     
    description: "Tag to use for the Docker image"
    required: true
        
  registry:
    description: "Container registry host"
    default: cr.alkhwarizmi.online
  username:
    description: "Registry username"
    required: true
  password:
    description: "Registry password"
    required: true


runs:
  using: "composite"
  steps:
    - name: Docker login
      uses: docker/login-action@v3
      with:
        registry: ${{ inputs.registry }}
        username: ${{ inputs.username }}
        password: ${{ inputs.password }}

    - name: Build
      shell: bash
      run: docker compose -f ${{ inputs.compose-file }} build --progress=plain
      env:
        IMAGE_TAG: ${{ inputs.image_tag }}

    - name: Push
      shell: bash
      run: docker compose -f ${{ inputs.compose-file }} push
